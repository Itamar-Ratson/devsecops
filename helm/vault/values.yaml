vault:
  global:
    enabled: true
    tlsDisable: true  # Disable TLS for initial setup, enable later

  injector:
    enabled: true
    replicas: 1
    resources:
      requests:
        memory: "64Mi"  # Reduced from 256Mi - actual usage ~16Mi
        cpu: "25m"  # Reduced from 250m - actual usage ~3m
      limits:
        memory: "128Mi"  # Reduced from 256Mi - allow burst headroom
        cpu: "50m"  # Reduced from 250m - allow some burst headroom

  server:
    enabled: true
    replicas: 1

    # Inject transit token from Kubernetes Secret
    # VAULT_TOKEN is automatically used by Vault for transit seal auth
    extraSecretEnvironmentVars:
      - envName: VAULT_TOKEN
        secretName: vault-transit-token
        secretKey: VAULT_TOKEN

    # Resource limits
    resources:
      requests:
        memory: "128Mi"  # Reduced from 256Mi - actual usage ~49Mi
        cpu: "250m"
      limits:
        memory: "256Mi"  # Reduced from 512Mi - allow burst headroom
        cpu: "500m"

    # Storage configuration - File storage (not HA)
    dataStorage:
      enabled: true
      size: 10Gi
      storageClass: null  # Use default storage class
      accessMode: ReadWriteOnce

    # File storage configuration (single replica)
    standalone:
      enabled: true
      config: |
        ui = true

        listener "tcp" {
          tls_disable = 1
          address = "[::]:8200"
          cluster_address = "[::]:8201"
          telemetry {
            unauthenticated_metrics_access = true
          }
        }

        storage "file" {
          path = "/vault/data"
        }

        # Auto-unseal using external Transit Vault (docker-compose)
        # NOTE: 172.18.0.4 is the Transit Vault IP on the KinD network
        # If recreating, run: docker network connect kind vault-transit
        # Token injected via VAULT_TRANSIT_TOKEN env var from K8s Secret
        seal "transit" {
          address = "http://172.18.0.4:8200"
          key_name = "autounseal"
          mount_path = "transit/"
        }

        telemetry {
          prometheus_retention_time = "30s"
          disable_hostname = true
        }

    # Service configuration
    service:
      enabled: true
      type: ClusterIP
      port: 8200
      targetPort: 8200

    # Readiness/Liveness probes
    readinessProbe:
      enabled: true
      path: "/v1/sys/health?standbyok=true&sealedcode=204&uninitcode=204"
    livenessProbe:
      enabled: true
      path: "/v1/sys/health?standbyok=true"
      initialDelaySeconds: 60

  # CSI Provider (disabled for now)
  csi:
    enabled: false

  # UI enabled
  ui:
    enabled: true
    serviceType: ClusterIP

# Transit seal configuration
# Override token at deploy time: --set server.seal.transit.token=$VAULT_TRANSIT_TOKEN
server:
  seal:
    transit:
      enabled: true
      token: ""  # REQUIRED: Set via --set or values override, never commit actual token

# Bootstrap configuration for automated Vault setup
# All secrets should be passed via --set at deploy time, never committed
bootstrap:
  enabled: true
  secrets:
    grafana:
      user: ""      # REQUIRED: Set via --set bootstrap.secrets.grafana.user
      password: ""  # REQUIRED: Set via --set bootstrap.secrets.grafana.password
    alertmanager:
      criticalWebhook: ""
      warningWebhook: ""
    argocd:
      # Generate hash: htpasswd -nbBC 10 "" 'your-password' | tr -d ':\n'
      passwordHash: ""      # REQUIRED: Set via --set bootstrap.secrets.argocd.passwordHash
      serverSecretKey: ""   # REQUIRED: Set via --set bootstrap.secrets.argocd.serverSecretKey
      repoUrl: ""
      sshPrivateKey: ""
