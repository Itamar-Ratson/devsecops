{{- if .Values.bootstrap.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-bootstrap-config
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: vault-bootstrap
    app.kubernetes.io/instance: {{ .Release.Name }}
data:
  # Vault policies
  policy-monitoring.hcl: |
    # Policy for monitoring namespace secrets
    path "secret/data/monitoring/*" {
      capabilities = ["read"]
    }
  policy-argocd.hcl: |
    # Policy for argocd namespace secrets
    path "secret/data/argocd/*" {
      capabilities = ["read"]
    }
  policy-keycloak.hcl: |
    # Policy for keycloak namespace secrets
    path "secret/data/keycloak/*" {
      capabilities = ["read"]
    }

  # Note: Actual secrets are read from vault-bootstrap-secrets Secret
  # which is created by setup.sh before ArgoCD deploys Vault
{{- end }}
