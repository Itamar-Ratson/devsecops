argo-cd:
  # Global settings
  global:
    # Disable network policies - we manage via CiliumNetworkPolicy
    networkPolicy:
      create: false

  # ArgoCD Server (UI + API)
  server:
    replicas: 1

    resources:
      limits:
        cpu: 500m
        memory: 128Mi
      requests:
        cpu: 100m
        memory: 64Mi  # Reduced based on metrics (33Mi used, 50Mi max)

    # Expose metrics for Prometheus
    metrics:
      enabled: true
      serviceMonitor:
        enabled: false  # We create our own ServiceMonitor

    # Insecure mode (terminate TLS at gateway)
    extraArgs:
      - --insecure

    service:
      type: ClusterIP
      servicePortHttp: 8080
      servicePortHttps: 443

  # Repo Server - handles Git operations
  repoServer:
    replicas: 1

    resources:
      limits:
        cpu: "1"
        memory: 512Mi
      requests:
        cpu: 250m
        memory: 320Mi  # Reduced based on metrics (134Mi used, 274Mi max)

    metrics:
      enabled: true
      serviceMonitor:
        enabled: false

  # Application Controller - reconciles desired vs actual state
  controller:
    replicas: 1

    resources:
      limits:
        cpu: "2"
        memory: 2Gi
      requests:
        cpu: 250m
        memory: 1Gi

    metrics:
      enabled: true
      serviceMonitor:
        enabled: false

  # Redis - used for caching
  redis:
    enabled: true
    resources:
      limits:
        cpu: 200m
        memory: 128Mi
      requests:
        cpu: 50m
        memory: 64Mi

  # Disable HA components for minimal installation
  redis-ha:
    enabled: false

  # ApplicationSet Controller - for generating Applications
  applicationSet:
    enabled: true
    replicas: 1
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 25m
        memory: 64Mi
    metrics:
      enabled: true
      serviceMonitor:
        enabled: false

  # Notifications Controller - disable unless needed
  notifications:
    enabled: false

  # Dex - disable external OIDC (use built-in auth)
  dex:
    enabled: false

  # CRDs - install via Helm
  crds:
    install: true
    keep: true

  # ConfigMaps for ArgoCD configuration
  configs:
    # Repository credentials are automatically configured by setup.sh:
    # - SSH key generated at ~/.ssh/argocd-deploy-key
    # - Secret created, sealed, and applied as SealedSecret
    # - Public key displayed for adding to GitHub as deploy key
    #
    # For manual setup or additional repos, create a SealedSecret:
    # kubectl create secret generic argocd-repo-creds -n argocd \
    #   --from-literal=type=git \
    #   --from-literal=url=git@github.com:yourorg \
    #   --from-file=sshPrivateKey=/path/to/key \
    #   --dry-run=client -o yaml | \
    #   kubectl label --local -f - argocd.argoproj.io/secret-type=repo-creds -o yaml | \
    #   kubeseal --controller-name=sealed-secrets --controller-namespace=sealed-secrets -o yaml | \
    #   kubectl apply -f -
    credentialTemplates: {}
    repositories: {}

    params:
      server.enable.gzip: true
      application.instanceLabelKey: argocd.argoproj.io/instance
